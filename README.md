# IndexedDB 前端持久化演示

这是一个完整的IndexedDB存储演示页面，用于验证浏览器本地数据库的存储和检索功能。

## 功能特性

### 🗄️ 数据持久化
- 数据存储在浏览器的IndexedDB中
- 关闭页面后数据仍然保留
- 支持大量数据的本地存储

### 📝 数据操作
- **添加记录**: 支持添加用户信息（姓名、邮箱、年龄、备注）
- **编辑记录**: 点击编辑按钮可修改现有记录
- **删除记录**: 支持单条记录删除
- **清空数据**: 一键清空所有数据

### 🔍 搜索功能
- 实时搜索，支持按姓名、邮箱或备注搜索
- 防抖优化，避免频繁查询
- 搜索结果实时显示

### 📤 数据导出/导入
- **导出数据**: 将所有数据导出为JSON文件
- **导入数据**: 支持从JSON文件导入数据
- 数据格式标准化

### 📊 数据统计
- 显示总记录数
- 显示数据库大小
- 实时更新统计信息

### 📋 操作日志
- 记录所有操作的历史
- 不同操作类型用不同颜色标识
- 自动限制日志数量

### 📱 PWA支持
- 可安装到手机桌面
- 完全离线使用
- 原生应用体验
- 自动缓存和更新

## 技术实现

### 数据库结构
```javascript
// 数据库名称: UserDatabase
// 版本: 1
// 存储对象: users

// 用户数据结构
{
  id: 1,                    // 自动递增主键
  name: "张三",             // 姓名
  email: "zhangsan@example.com", // 邮箱
  age: 25,                  // 年龄（可选）
  notes: "备注信息",        // 备注（可选）
  createdAt: "2024-01-01T00:00:00.000Z", // 创建时间
  updatedAt: "2024-01-01T00:00:00.000Z"  // 更新时间（编辑时）
}
```

### 索引设计
- `name`: 姓名索引
- `email`: 邮箱索引  
- `createdAt`: 创建时间索引

## 使用方法

### 1. 电脑端访问
直接在浏览器中打开 `index.html` 文件即可。

### 2. 手机端访问（推荐）

#### 方法一：PWA离线应用（最推荐）

**优势**：
- ✅ 完全离线使用，无需网络
- ✅ 可安装到手机桌面
- ✅ 原生应用体验
- ✅ 数据持久化存储

**使用步骤**：
1. 在有网络环境下首次访问应用
2. 将应用安装到手机桌面
3. 之后即可完全离线使用

**详细指南**：请查看 [PWA-GUIDE.md](./PWA-GUIDE.md) 文件

#### 方法二：使用本地服务器

1. **安装Node.js**
   - 访问 https://nodejs.org/
   - 下载并安装Node.js

2. **启动服务器**
   - **Windows**: 双击运行 `start.bat`
   - **Mac/Linux**: 
     ```bash
     chmod +x start.sh  # 添加执行权限（首次运行）
     ./start.sh         # 运行启动脚本
     ```
   - **手动启动**: 在项目目录运行 `node server.js`

3. **手机访问**
   - 确保手机和电脑连接同一WiFi网络
   - 在手机浏览器中输入显示的IP地址（如：http://192.168.1.100:3000）

#### 方法三：使用其他本地服务器

如果不想安装Node.js，也可以使用其他工具：

**Python 3:**
```bash
python -m http.server 3000
```

**Python 2:**
```bash
python -m SimpleHTTPServer 3000
```

**PHP:**
```bash
php -S 0.0.0.0:3000
```

#### 方法四：直接保存到手机（有限制）

- **Android**: 将HTML文件保存到手机，用浏览器打开（功能可能受限）
- **iOS**: Safari对本地IndexedDB支持有限制，不推荐此方法

### 2. 添加数据
1. 在左侧表单中填写用户信息
2. 点击"➕ 添加记录"按钮
3. 数据将保存到IndexedDB中

### 3. 搜索数据
在搜索框中输入关键词，系统会自动搜索并显示匹配的记录。

### 4. 编辑数据
1. 点击表格中的"编辑"按钮
2. 表单会自动填充当前记录信息
3. 修改后点击"💾 更新记录"保存

### 5. 删除数据
点击表格中的"删除"按钮，确认后删除该记录。

### 6. 导出数据
点击"📤 导出数据"按钮，系统会下载包含所有数据的JSON文件。

### 7. 导入数据
1. 点击"📥 导入数据"按钮
2. 选择之前导出的JSON文件
3. 系统会清空现有数据并导入新数据

## 浏览器兼容性

- ✅ Chrome 23+
- ✅ Firefox 16+
- ✅ Safari 10+
- ✅ Edge 12+
- ❌ Internet Explorer (不支持)

## 注意事项

1. **数据持久化**: 数据存储在浏览器本地，清除浏览器数据会导致数据丢失
2. **存储限制**: IndexedDB的存储空间取决于浏览器和设备的可用空间
3. **隐私模式**: 在隐私模式下，关闭标签页后数据会被清除
4. **跨域限制**: IndexedDB遵循同源策略，不同域名无法访问彼此的数据库
5. **手机访问**: 建议使用本地服务器方式访问，直接打开HTML文件功能可能受限
6. **网络要求**: 手机访问需要确保与电脑在同一WiFi网络下

## 开发说明

### 项目结构
```
travel_pro/
├── index.html      # 主页面
├── styles.css      # 样式文件
├── script.js       # JavaScript逻辑
├── server.js       # Node.js本地服务器
├── package.json    # 项目配置文件
├── start.bat       # Windows启动脚本
├── start.sh        # Linux/Mac启动脚本
├── manifest.json   # PWA清单文件
├── sw.js          # Service Worker
├── PWA-GUIDE.md   # PWA使用指南
└── README.md       # 说明文档
```

### 核心类
- `IndexedDBManager`: 数据库管理类，处理所有IndexedDB操作
- `IndexedDBDemo`: 应用主类，处理UI交互和业务逻辑

### 主要方法
- `init()`: 初始化数据库连接
- `addUser()`: 添加用户记录
- `getAllUsers()`: 获取所有用户
- `searchUsers()`: 搜索用户
- `updateUser()`: 更新用户信息
- `deleteUser()`: 删除用户
- `exportData()`: 导出数据
- `importData()`: 导入数据

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查浏览器是否支持IndexedDB
   - 检查浏览器是否启用了隐私模式
   - 尝试刷新页面重新初始化

2. **数据不显示**
   - 检查浏览器控制台是否有错误信息
   - 确认数据库初始化成功
   - 查看操作日志了解详细错误

3. **导入数据失败**
   - 确认JSON文件格式正确
   - 检查文件是否损坏
   - 查看操作日志了解具体错误

### 调试方法

1. 打开浏览器开发者工具
2. 查看Console标签页的错误信息
3. 在Application标签页中查看IndexedDB存储
4. 查看操作日志了解详细执行过程

## 许可证

MIT License

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅行助手 - 智能旅行规划工具</title>
    <meta name="description" content="智能旅行助手，帮助您规划完美的旅行计划和管理预算">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="旅行助手">
    
    <!-- 现代化字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PWA 支持 -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxwYXRoIGQ9Ik05NiA0OEM3My45MDg2IDQ4IDU2IDY1LjkwODYgNTYgODhWMTQ0QzU2IDE2Ni4wOTEgNzMuOTA4NiAxODQgOTYgMTg0QzExOC4wOTEgMTg0IDEzNiAxNjYuMDkxIDEzNiAxNDRWODhDMTM2IDY1LjkwODYgMTE4LjA5MSA0OCA5NiA0OFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik05NiA2NEM4MS42NDA2IDY0IDcwIDc1LjY0MDYgNzAgOTBWMTA0QzcwIDExOC4zNTkgODEuNjQwNiAxMzAgOTYgMTMwQzExMC4zNTkgMTMwIDEyMiAxMTguMzU5IDEyMiAxMDRWOTBDMTIyIDc1LjY0MDYgMTEwLjM1OSA2NCA5NiA2NFoiIGZpbGw9IiM2NjdlZWEiLz4KPC9zdmc+">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 应用容器 -->
    <div class="app-container">
        <!-- 顶部状态栏 -->
        <div class="status-bar">
            <div class="status-left">
                <span class="time" id="currentTime">12:00</span>
            </div>
            <div class="status-right">
                <span class="signal">📶</span>
                <span class="wifi">📶</span>
                <span class="battery">🔋</span>
            </div>
        </div>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 首页 -->
            <section class="page active" id="home-page">
                <!-- 顶部欢迎区域 -->
                <div class="welcome-section">
                    <div class="welcome-header">
                        <div class="avatar">
                            <span>👤</span>
                        </div>
                        <div class="welcome-text">
                            <h1>你好，旅行者</h1>
                            <p>准备好开始新的冒险了吗？</p>
                        </div>
                        <div class="notification-bell">
                            <span>🔔</span>
                            <span class="notification-badge">3</span>
                        </div>
                    </div>
                </div>

                <!-- 快速统计卡片 -->
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-icon">✈️</div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalTrips">0</span>
                            <span class="stat-label">旅行计划</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💰</div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalBudget">¥0</span>
                            <span class="stat-label">总预算</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-info">
                            <span class="stat-number" id="packedItems">0</span>
                            <span class="stat-label">已打包</span>
                        </div>
                    </div>
                </div>

                <!-- 最近旅行 -->
                <div class="section-header">
                    <h2>最近的旅行</h2>
                    <button class="view-all-btn" onclick="app.switchPage('trips')">查看全部</button>
                </div>
                <div class="recent-trips" id="recentTrips">
                    <div class="empty-state">
                        <div class="empty-icon">✈️</div>
                        <p>还没有旅行计划</p>
                        <button class="btn btn-primary" onclick="app.showAddTripModal()">创建第一个计划</button>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="quick-actions">
                    <div class="action-card" onclick="app.showAddTripModal()">
                        <div class="action-icon">➕</div>
                        <span>新建旅行</span>
                    </div>
                    <div class="action-card" onclick="app.showAddExpenseModal()">
                        <div class="action-icon">💰</div>
                        <span>记录支出</span>
                    </div>
                    <div class="action-card" onclick="app.showAddItemModal()">
                        <div class="action-icon">📦</div>
                        <span>添加物品</span>
                    </div>
                    <div class="action-card" onclick="app.switchPage('stats')">
                        <div class="action-icon">📊</div>
                        <span>查看统计</span>
                    </div>
                </div>
            </section>

            <!-- 旅行计划页面 -->
            <section class="page" id="trips-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">←</button>
                    <h1>旅行计划</h1>
                    <button class="add-btn" onclick="app.showAddTripModal()">➕</button>
                </div>

                <!-- 搜索栏 -->
                <div class="search-bar">
                    <div class="search-input">
                        <span class="search-icon">🔍</span>
                        <input type="text" placeholder="搜索旅行计划..." id="searchTrips">
                    </div>
                    <button class="filter-btn">筛选</button>
                </div>

                <!-- 旅行列表 -->
                <div class="trips-list" id="tripsList">
                    <!-- 动态生成旅行卡片 -->
                </div>
            </section>

            <!-- 预算管理页面 -->
            <section class="page" id="budget-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">←</button>
                    <h1>预算管理</h1>
                    <button class="add-btn" onclick="app.showAddExpenseModal()">➕</button>
                </div>

                <!-- 预算概览 -->
                <div class="budget-overview">
                    <div class="budget-card">
                        <div class="budget-header">
                            <h3>总预算</h3>
                            <span class="budget-amount" id="totalBudgetAmount">¥0</span>
                        </div>
                        <div class="budget-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="budgetProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">已使用 <span id="usedBudget">¥0</span></span>
                        </div>
                    </div>
                </div>

                <!-- 支出列表 -->
                <div class="expenses-list" id="expensesList">
                    <!-- 动态生成支出卡片 -->
                </div>
            </section>

            <!-- 行李清单页面 -->
            <section class="page" id="checklist-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">←</button>
                    <h1>行李清单</h1>
                    <button class="add-btn" onclick="app.showAddItemModal()">➕</button>
                </div>

                <!-- 打包进度 -->
                <div class="packing-progress">
                    <div class="progress-card">
                        <div class="progress-header">
                            <h3>打包进度</h3>
                            <span class="progress-percentage" id="packingPercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="packingProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-stats">
                            <span>已打包: <span id="packedCount">0</span></span>
                            <span>总计: <span id="totalCount">0</span></span>
                        </div>
                    </div>
                </div>

                <!-- 物品列表 -->
                <div class="items-list" id="itemsList">
                    <!-- 动态生成物品卡片 -->
                </div>
            </section>

            <!-- 统计页面 -->
            <section class="page" id="stats-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">←</button>
                    <h1>统计概览</h1>
                    <button class="share-btn">📤</button>
                </div>

                <!-- 统计卡片网格 -->
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>旅行统计</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>总旅行次数</span>
                                <span id="totalTripCount">0</span>
                            </div>
                            <div class="stat-row">
                                <span>已完成</span>
                                <span id="completedTrips">0</span>
                            </div>
                            <div class="stat-row">
                                <span>进行中</span>
                                <span id="ongoingTrips">0</span>
                            </div>
                            <div class="stat-row">
                                <span>计划中</span>
                                <span id="plannedTrips">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>预算统计</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>总预算</span>
                                <span id="totalBudgetStats">¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>总支出</span>
                                <span id="totalExpensesStats">¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>平均支出</span>
                                <span id="avgExpense">¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>预算使用率</span>
                                <span id="budgetUsage">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>支出分类</h3>
                        <div class="stats-content" id="categoryStats">
                            <!-- 动态生成分类统计 -->
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>行李统计</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>总物品数</span>
                                <span id="totalItemsStats">0</span>
                            </div>
                            <div class="stat-row">
                                <span>已打包</span>
                                <span id="packedItemsStats">0</span>
                            </div>
                            <div class="stat-row">
                                <span>打包率</span>
                                <span id="packingRate">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部导航栏 -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="home">
                <span class="nav-icon">🏠</span>
                <span class="nav-label">首页</span>
            </button>
            <button class="nav-item" data-page="trips">
                <span class="nav-icon">✈️</span>
                <span class="nav-label">旅行</span>
            </button>
            <button class="nav-item" data-page="budget">
                <span class="nav-icon">💰</span>
                <span class="nav-label">预算</span>
            </button>
            <button class="nav-item" data-page="checklist">
                <span class="nav-icon">📦</span>
                <span class="nav-label">清单</span>
            </button>
            <button class="nav-item" data-page="stats">
                <span class="nav-icon">📊</span>
                <span class="nav-label">统计</span>
            </button>
        </nav>

        <!-- 浮动操作按钮 -->
        <button class="fab" id="fab" onclick="app.showQuickActions()">
            <span class="fab-icon">+</span>
        </button>
    </div>

    <!-- 模态框 -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal" id="modal">
            <!-- 模态框内容将动态生成 -->
        </div>
    </div>

    <!-- 快速操作菜单 -->
    <div class="quick-actions-menu" id="quickActionsMenu" style="display: none;">
        <div class="quick-action-item" onclick="app.showAddTripModal()">
            <span class="action-icon">✈️</span>
            <span>新建旅行</span>
        </div>
        <div class="quick-action-item" onclick="app.showAddExpenseModal()">
            <span class="action-icon">💰</span>
            <span>记录支出</span>
        </div>
        <div class="quick-action-item" onclick="app.showAddItemModal()">
            <span class="action-icon">📦</span>
            <span>添加物品</span>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker 注册和状态管理 -->
    <script>
        // PWA状态管理
        class PWAManager {
            constructor() {
                this.isOnline = navigator.onLine;
                this.isInstalled = window.matchMedia('(display-mode: standalone)').matches;
                this.init();
            }
            
            init() {
                this.registerServiceWorker();
                this.setupNetworkListeners();
                this.setupInstallPrompt();
                this.showStatusIndicator();
            }
            
            // 注册Service Worker
            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('/sw.js')
                            .then((registration) => {
                                console.log('Service Worker注册成功:', registration.scope);
                                this.updateStatus('Service Worker已激活');
                            })
                            .catch((error) => {
                                console.log('Service Worker注册失败:', error);
                                this.updateStatus('Service Worker注册失败');
                            });
                    });
                }
            }
            
            // 设置网络状态监听
            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateStatus('网络已连接');
                    this.hideOfflineIndicator();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateStatus('网络已断开，但应用仍可离线使用');
                    this.showOfflineIndicator();
                });
            }
            
            // 设置安装提示
            setupInstallPrompt() {
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    this.showInstallButton(deferredPrompt);
                });
                
                // 监听应用安装完成
                window.addEventListener('appinstalled', () => {
                    this.isInstalled = true;
                    this.updateStatus('应用已安装到桌面');
                    this.hideInstallButton();
                });
            }
            
            // 显示安装按钮
            showInstallButton(deferredPrompt) {
                if (document.getElementById('pwa-install-btn')) return;
                
                const installButton = document.createElement('button');
                installButton.id = 'pwa-install-btn';
                installButton.textContent = '📱 安装应用';
                installButton.className = 'btn btn-primary';
                installButton.style.position = 'fixed';
                installButton.style.top = '20px';
                installButton.style.right = '20px';
                installButton.style.zIndex = '1000';
                installButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                
                installButton.addEventListener('click', () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('用户接受了安装提示');
                                this.updateStatus('正在安装应用...');
                            }
                            deferredPrompt = null;
                            this.hideInstallButton();
                        });
                    }
                });
                
                document.body.appendChild(installButton);
            }
            
            // 隐藏安装按钮
            hideInstallButton() {
                const installButton = document.getElementById('pwa-install-btn');
                if (installButton) {
                    installButton.remove();
                }
            }
            
            // 显示离线指示器
            showOfflineIndicator() {
                if (document.getElementById('offline-indicator')) return;
                
                const indicator = document.createElement('div');
                indicator.id = 'offline-indicator';
                indicator.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: #ff6b6b;
                        color: white;
                        text-align: center;
                        padding: 8px;
                        font-size: 14px;
                        z-index: 9999;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    ">
                        📱 离线模式 - 应用仍可正常使用
                    </div>
                `;
                document.body.appendChild(indicator);
            }
            
            // 隐藏离线指示器
            hideOfflineIndicator() {
                const indicator = document.getElementById('offline-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
            
            // 显示状态指示器
            showStatusIndicator() {
                const statusDiv = document.createElement('div');
                statusDiv.id = 'pwa-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    z-index: 1000;
                    opacity: 0.8;
                    transition: opacity 0.3s;
                `;
                statusDiv.textContent = this.isOnline ? '在线' : '离线';
                document.body.appendChild(statusDiv);
                
                // 3秒后隐藏状态指示器
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    setTimeout(() => statusDiv.remove(), 300);
                }, 3000);
            }
            
            // 更新状态
            updateStatus(message) {
                const statusDiv = document.getElementById('pwa-status');
                if (statusDiv) {
                    statusDiv.textContent = message;
                    statusDiv.style.opacity = '1';
                    
                    setTimeout(() => {
                        statusDiv.style.opacity = '0';
                        setTimeout(() => statusDiv.remove(), 300);
                    }, 2000);
                }
            }
        }
        
        // 初始化PWA管理器
        const pwaManager = new PWAManager();
    </script>
</body>
</html>

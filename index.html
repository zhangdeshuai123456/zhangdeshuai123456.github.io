<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…è¡ŒåŠ©æ‰‹ - æ™ºèƒ½æ—…è¡Œè§„åˆ’å·¥å…·</title>
    <meta name="description" content="æ™ºèƒ½æ—…è¡ŒåŠ©æ‰‹ï¼Œå¸®åŠ©æ‚¨è§„åˆ’å®Œç¾çš„æ—…è¡Œè®¡åˆ’å’Œç®¡ç†é¢„ç®—">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æ—…è¡ŒåŠ©æ‰‹">
    
    <!-- ç°ä»£åŒ–å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PWA æ”¯æŒ -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxwYXRoIGQ9Ik05NiA0OEM3My45MDg2IDQ4IDU2IDY1LjkwODYgNTYgODhWMTQ0QzU2IDE2Ni4wOTEgNzMuOTA4NiAxODQgOTYgMTg0QzExOC4wOTEgMTg0IDEzNiAxNjYuMDkxIDEzNiAxNDRWODhDMTM2IDY1LjkwODYgMTE4LjA5MSA0OCA5NiA0OFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik05NiA2NEM4MS42NDA2IDY0IDcwIDc1LjY0MDYgNzAgOTBWMTA0QzcwIDExOC4zNTkgODEuNjQwNiAxMzAgOTYgMTMwQzExMC4zNTkgMTMwIDEyMiAxMTguMzU5IDEyMiAxMDRWOTBDMTIyIDc1LjY0MDYgMTEwLjM1OSA2NCA5NiA2NFoiIGZpbGw9IiM2NjdlZWEiLz4KPC9zdmc+">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- åº”ç”¨å®¹å™¨ -->
    <div class="app-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-left">
                <span class="time" id="currentTime">12:00</span>
            </div>
            <div class="status-right">
                <span class="signal">ğŸ“¶</span>
                <span class="wifi">ğŸ“¶</span>
                <span class="battery">ğŸ”‹</span>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- é¦–é¡µ -->
            <section class="page active" id="home-page">
                <!-- é¡¶éƒ¨æ¬¢è¿åŒºåŸŸ -->
                <div class="welcome-section">
                    <div class="welcome-header">
                        <div class="avatar">
                            <span>ğŸ‘¤</span>
                        </div>
                        <div class="welcome-text">
                            <h1>ä½ å¥½ï¼Œæ—…è¡Œè€…</h1>
                            <p>å‡†å¤‡å¥½å¼€å§‹æ–°çš„å†’é™©äº†å—ï¼Ÿ</p>
                        </div>
                        <div class="notification-bell">
                            <span>ğŸ””</span>
                            <span class="notification-badge">3</span>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿç»Ÿè®¡å¡ç‰‡ -->
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-icon">âœˆï¸</div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalTrips">0</span>
                            <span class="stat-label">æ—…è¡Œè®¡åˆ’</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’°</div>
                        <div class="stat-info">
                            <span class="stat-number" id="totalBudget">Â¥0</span>
                            <span class="stat-label">æ€»é¢„ç®—</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-info">
                            <span class="stat-number" id="packedItems">0</span>
                            <span class="stat-label">å·²æ‰“åŒ…</span>
                        </div>
                    </div>
                </div>

                <!-- æœ€è¿‘æ—…è¡Œ -->
                <div class="section-header">
                    <h2>æœ€è¿‘çš„æ—…è¡Œ</h2>
                    <button class="view-all-btn" onclick="app.switchPage('trips')">æŸ¥çœ‹å…¨éƒ¨</button>
                </div>
                <div class="recent-trips" id="recentTrips">
                    <div class="empty-state">
                        <div class="empty-icon">âœˆï¸</div>
                        <p>è¿˜æ²¡æœ‰æ—…è¡Œè®¡åˆ’</p>
                        <button class="btn btn-primary" onclick="app.showAddTripModal()">åˆ›å»ºç¬¬ä¸€ä¸ªè®¡åˆ’</button>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="quick-actions">
                    <div class="action-card" onclick="app.showAddTripModal()">
                        <div class="action-icon">â•</div>
                        <span>æ–°å»ºæ—…è¡Œ</span>
                    </div>
                    <div class="action-card" onclick="app.showAddExpenseModal()">
                        <div class="action-icon">ğŸ’°</div>
                        <span>è®°å½•æ”¯å‡º</span>
                    </div>
                    <div class="action-card" onclick="app.showAddItemModal()">
                        <div class="action-icon">ğŸ“¦</div>
                        <span>æ·»åŠ ç‰©å“</span>
                    </div>
                    <div class="action-card" onclick="app.switchPage('stats')">
                        <div class="action-icon">ğŸ“Š</div>
                        <span>æŸ¥çœ‹ç»Ÿè®¡</span>
                    </div>
                </div>
            </section>

            <!-- æ—…è¡Œè®¡åˆ’é¡µé¢ -->
            <section class="page" id="trips-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">â†</button>
                    <h1>æ—…è¡Œè®¡åˆ’</h1>
                    <button class="add-btn" onclick="app.showAddTripModal()">â•</button>
                </div>

                <!-- æœç´¢æ  -->
                <div class="search-bar">
                    <div class="search-input">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" placeholder="æœç´¢æ—…è¡Œè®¡åˆ’..." id="searchTrips">
                    </div>
                    <button class="filter-btn">ç­›é€‰</button>
                </div>

                <!-- æ—…è¡Œåˆ—è¡¨ -->
                <div class="trips-list" id="tripsList">
                    <!-- åŠ¨æ€ç”Ÿæˆæ—…è¡Œå¡ç‰‡ -->
                </div>
            </section>

            <!-- é¢„ç®—ç®¡ç†é¡µé¢ -->
            <section class="page" id="budget-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">â†</button>
                    <h1>é¢„ç®—ç®¡ç†</h1>
                    <button class="add-btn" onclick="app.showAddExpenseModal()">â•</button>
                </div>

                <!-- é¢„ç®—æ¦‚è§ˆ -->
                <div class="budget-overview">
                    <div class="budget-card">
                        <div class="budget-header">
                            <h3>æ€»é¢„ç®—</h3>
                            <span class="budget-amount" id="totalBudgetAmount">Â¥0</span>
                        </div>
                        <div class="budget-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="budgetProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">å·²ä½¿ç”¨ <span id="usedBudget">Â¥0</span></span>
                        </div>
                    </div>
                </div>

                <!-- æ”¯å‡ºåˆ—è¡¨ -->
                <div class="expenses-list" id="expensesList">
                    <!-- åŠ¨æ€ç”Ÿæˆæ”¯å‡ºå¡ç‰‡ -->
                </div>
            </section>

            <!-- è¡Œææ¸…å•é¡µé¢ -->
            <section class="page" id="checklist-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">â†</button>
                    <h1>è¡Œææ¸…å•</h1>
                    <button class="add-btn" onclick="app.showAddItemModal()">â•</button>
                </div>

                <!-- æ‰“åŒ…è¿›åº¦ -->
                <div class="packing-progress">
                    <div class="progress-card">
                        <div class="progress-header">
                            <h3>æ‰“åŒ…è¿›åº¦</h3>
                            <span class="progress-percentage" id="packingPercentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="packingProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-stats">
                            <span>å·²æ‰“åŒ…: <span id="packedCount">0</span></span>
                            <span>æ€»è®¡: <span id="totalCount">0</span></span>
                        </div>
                    </div>
                </div>

                <!-- ç‰©å“åˆ—è¡¨ -->
                <div class="items-list" id="itemsList">
                    <!-- åŠ¨æ€ç”Ÿæˆç‰©å“å¡ç‰‡ -->
                </div>
            </section>

            <!-- ç»Ÿè®¡é¡µé¢ -->
            <section class="page" id="stats-page">
                <div class="page-header">
                    <button class="back-btn" onclick="app.switchPage('home')">â†</button>
                    <h1>ç»Ÿè®¡æ¦‚è§ˆ</h1>
                    <button class="share-btn">ğŸ“¤</button>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ -->
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>æ—…è¡Œç»Ÿè®¡</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>æ€»æ—…è¡Œæ¬¡æ•°</span>
                                <span id="totalTripCount">0</span>
                            </div>
                            <div class="stat-row">
                                <span>å·²å®Œæˆ</span>
                                <span id="completedTrips">0</span>
                            </div>
                            <div class="stat-row">
                                <span>è¿›è¡Œä¸­</span>
                                <span id="ongoingTrips">0</span>
                            </div>
                            <div class="stat-row">
                                <span>è®¡åˆ’ä¸­</span>
                                <span id="plannedTrips">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>é¢„ç®—ç»Ÿè®¡</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>æ€»é¢„ç®—</span>
                                <span id="totalBudgetStats">Â¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>æ€»æ”¯å‡º</span>
                                <span id="totalExpensesStats">Â¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>å¹³å‡æ”¯å‡º</span>
                                <span id="avgExpense">Â¥0</span>
                            </div>
                            <div class="stat-row">
                                <span>é¢„ç®—ä½¿ç”¨ç‡</span>
                                <span id="budgetUsage">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>æ”¯å‡ºåˆ†ç±»</h3>
                        <div class="stats-content" id="categoryStats">
                            <!-- åŠ¨æ€ç”Ÿæˆåˆ†ç±»ç»Ÿè®¡ -->
                        </div>
                    </div>

                    <div class="stats-card">
                        <h3>è¡Œæç»Ÿè®¡</h3>
                        <div class="stats-content">
                            <div class="stat-row">
                                <span>æ€»ç‰©å“æ•°</span>
                                <span id="totalItemsStats">0</span>
                            </div>
                            <div class="stat-row">
                                <span>å·²æ‰“åŒ…</span>
                                <span id="packedItemsStats">0</span>
                            </div>
                            <div class="stat-row">
                                <span>æ‰“åŒ…ç‡</span>
                                <span id="packingRate">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="home">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-label">é¦–é¡µ</span>
            </button>
            <button class="nav-item" data-page="trips">
                <span class="nav-icon">âœˆï¸</span>
                <span class="nav-label">æ—…è¡Œ</span>
            </button>
            <button class="nav-item" data-page="budget">
                <span class="nav-icon">ğŸ’°</span>
                <span class="nav-label">é¢„ç®—</span>
            </button>
            <button class="nav-item" data-page="checklist">
                <span class="nav-icon">ğŸ“¦</span>
                <span class="nav-label">æ¸…å•</span>
            </button>
            <button class="nav-item" data-page="stats">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">ç»Ÿè®¡</span>
            </button>
        </nav>

        <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
        <button class="fab" id="fab" onclick="app.showQuickActions()">
            <span class="fab-icon">+</span>
        </button>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal" id="modal">
            <!-- æ¨¡æ€æ¡†å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å¿«é€Ÿæ“ä½œèœå• -->
    <div class="quick-actions-menu" id="quickActionsMenu" style="display: none;">
        <div class="quick-action-item" onclick="app.showAddTripModal()">
            <span class="action-icon">âœˆï¸</span>
            <span>æ–°å»ºæ—…è¡Œ</span>
        </div>
        <div class="quick-action-item" onclick="app.showAddExpenseModal()">
            <span class="action-icon">ğŸ’°</span>
            <span>è®°å½•æ”¯å‡º</span>
        </div>
        <div class="quick-action-item" onclick="app.showAddItemModal()">
            <span class="action-icon">ğŸ“¦</span>
            <span>æ·»åŠ ç‰©å“</span>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker æ³¨å†Œå’ŒçŠ¶æ€ç®¡ç† -->
    <script>
        // PWAçŠ¶æ€ç®¡ç†
        class PWAManager {
            constructor() {
                this.isOnline = navigator.onLine;
                this.isInstalled = window.matchMedia('(display-mode: standalone)').matches;
                this.init();
            }
            
            init() {
                this.registerServiceWorker();
                this.setupNetworkListeners();
                this.setupInstallPrompt();
                this.showStatusIndicator();
            }
            
            // æ³¨å†ŒService Worker
            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('/sw.js')
                            .then((registration) => {
                                console.log('Service Workeræ³¨å†ŒæˆåŠŸ:', registration.scope);
                                this.updateStatus('Service Workerå·²æ¿€æ´»');
                            })
                            .catch((error) => {
                                console.log('Service Workeræ³¨å†Œå¤±è´¥:', error);
                                this.updateStatus('Service Workeræ³¨å†Œå¤±è´¥');
                            });
                    });
                }
            }
            
            // è®¾ç½®ç½‘ç»œçŠ¶æ€ç›‘å¬
            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateStatus('ç½‘ç»œå·²è¿æ¥');
                    this.hideOfflineIndicator();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateStatus('ç½‘ç»œå·²æ–­å¼€ï¼Œä½†åº”ç”¨ä»å¯ç¦»çº¿ä½¿ç”¨');
                    this.showOfflineIndicator();
                });
            }
            
            // è®¾ç½®å®‰è£…æç¤º
            setupInstallPrompt() {
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    this.showInstallButton(deferredPrompt);
                });
                
                // ç›‘å¬åº”ç”¨å®‰è£…å®Œæˆ
                window.addEventListener('appinstalled', () => {
                    this.isInstalled = true;
                    this.updateStatus('åº”ç”¨å·²å®‰è£…åˆ°æ¡Œé¢');
                    this.hideInstallButton();
                });
            }
            
            // æ˜¾ç¤ºå®‰è£…æŒ‰é’®
            showInstallButton(deferredPrompt) {
                if (document.getElementById('pwa-install-btn')) return;
                
                const installButton = document.createElement('button');
                installButton.id = 'pwa-install-btn';
                installButton.textContent = 'ğŸ“± å®‰è£…åº”ç”¨';
                installButton.className = 'btn btn-primary';
                installButton.style.position = 'fixed';
                installButton.style.top = '20px';
                installButton.style.right = '20px';
                installButton.style.zIndex = '1000';
                installButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                
                installButton.addEventListener('click', () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…æç¤º');
                                this.updateStatus('æ­£åœ¨å®‰è£…åº”ç”¨...');
                            }
                            deferredPrompt = null;
                            this.hideInstallButton();
                        });
                    }
                });
                
                document.body.appendChild(installButton);
            }
            
            // éšè—å®‰è£…æŒ‰é’®
            hideInstallButton() {
                const installButton = document.getElementById('pwa-install-btn');
                if (installButton) {
                    installButton.remove();
                }
            }
            
            // æ˜¾ç¤ºç¦»çº¿æŒ‡ç¤ºå™¨
            showOfflineIndicator() {
                if (document.getElementById('offline-indicator')) return;
                
                const indicator = document.createElement('div');
                indicator.id = 'offline-indicator';
                indicator.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: #ff6b6b;
                        color: white;
                        text-align: center;
                        padding: 8px;
                        font-size: 14px;
                        z-index: 9999;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    ">
                        ğŸ“± ç¦»çº¿æ¨¡å¼ - åº”ç”¨ä»å¯æ­£å¸¸ä½¿ç”¨
                    </div>
                `;
                document.body.appendChild(indicator);
            }
            
            // éšè—ç¦»çº¿æŒ‡ç¤ºå™¨
            hideOfflineIndicator() {
                const indicator = document.getElementById('offline-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
            
            // æ˜¾ç¤ºçŠ¶æ€æŒ‡ç¤ºå™¨
            showStatusIndicator() {
                const statusDiv = document.createElement('div');
                statusDiv.id = 'pwa-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    z-index: 1000;
                    opacity: 0.8;
                    transition: opacity 0.3s;
                `;
                statusDiv.textContent = this.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿';
                document.body.appendChild(statusDiv);
                
                // 3ç§’åéšè—çŠ¶æ€æŒ‡ç¤ºå™¨
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    setTimeout(() => statusDiv.remove(), 300);
                }, 3000);
            }
            
            // æ›´æ–°çŠ¶æ€
            updateStatus(message) {
                const statusDiv = document.getElementById('pwa-status');
                if (statusDiv) {
                    statusDiv.textContent = message;
                    statusDiv.style.opacity = '1';
                    
                    setTimeout(() => {
                        statusDiv.style.opacity = '0';
                        setTimeout(() => statusDiv.remove(), 300);
                    }, 2000);
                }
            }
        }
        
        // åˆå§‹åŒ–PWAç®¡ç†å™¨
        const pwaManager = new PWAManager();
    </script>
</body>
</html>

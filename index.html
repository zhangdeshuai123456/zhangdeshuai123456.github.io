<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB å­˜å‚¨æ¼”ç¤º</title>
    <meta name="description" content="IndexedDBå‰ç«¯æŒä¹…åŒ–æ¼”ç¤ºåº”ç”¨ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="IndexedDB Demo">
    
    <!-- PWA æ”¯æŒ -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxwYXRoIGQ9Ik05NiA0OEM3My45MDg2IDQ4IDU2IDY1LjkwODYgNTYgODhWMTQ0QzU2IDE2Ni4wOTEgNzMuOTA4NiAxODQgOTYgMTg0QzExOC4wOTEgMTg0IDEzNiAxNjYuMDkxIDEzNiAxNDRWODhDMTM2IDY1LjkwODYgMTE4LjA5MSA0OCA5NiA0OFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik05NiA2NEM4MS42NDA2IDY0IDcwIDc1LjY0MDYgNzAgOTBWMTA0QzcwIDExOC4zNTkgODEuNjQwNiAxMzAgOTYgMTMwQzExMC4zNTkgMTMwIDEyMiAxMTguMzU5IDEyMiAxMDRWOTBDMTIyIDc1LjY0MDYgMTEwLjM1OSA2NCA5NiA2NFoiIGZpbGw9IiM2NjdlZWEiLz4KPC9zdmc+">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ—„ï¸ IndexedDB å‰ç«¯æŒä¹…åŒ–æ¼”ç¤º</h1>
            <p>éªŒè¯æµè§ˆå™¨æœ¬åœ°æ•°æ®åº“çš„å­˜å‚¨å’Œæ£€ç´¢åŠŸèƒ½</p>
        </header>

        <div class="demo-section">
            <div class="control-panel">
                <h2>ğŸ“ æ•°æ®æ“ä½œ</h2>
                
                <div class="form-group">
                    <label for="name">å§“å:</label>
                    <input type="text" id="name" placeholder="è¯·è¾“å…¥å§“å">
                </div>
                
                <div class="form-group">
                    <label for="email">é‚®ç®±:</label>
                    <input type="email" id="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                </div>
                
                <div class="form-group">
                    <label for="age">å¹´é¾„:</label>
                    <input type="number" id="age" placeholder="è¯·è¾“å…¥å¹´é¾„">
                </div>
                
                <div class="form-group">
                    <label for="notes">å¤‡æ³¨:</label>
                    <textarea id="notes" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
                
                <div class="button-group">
                    <button id="addBtn" class="btn btn-primary">â• æ·»åŠ è®°å½•</button>
                    <button id="clearBtn" class="btn btn-danger">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
                    <button id="exportBtn" class="btn btn-success">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button id="importBtn" class="btn btn-info">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                </div>
            </div>

            <div class="data-display">
                <h2>ğŸ“Š æ•°æ®å±•ç¤º</h2>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalCount">0</span>
                        <span class="stat-label">æ€»è®°å½•æ•°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="dbSize">0 KB</span>
                        <span class="stat-label">æ•°æ®åº“å¤§å°</span>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢è®°å½•...">
                </div>
                
                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>å§“å</th>
                                <th>é‚®ç®±</th>
                                <th>å¹´é¾„</th>
                                <th>å¤‡æ³¨</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>â„¹ï¸ åŠŸèƒ½è¯´æ˜</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>ğŸ’¾ æ•°æ®æŒä¹…åŒ–</h3>
                    <p>æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨çš„IndexedDBä¸­ï¼Œå…³é—­é¡µé¢åæ•°æ®ä»ç„¶ä¿ç•™</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ” æœç´¢åŠŸèƒ½</h3>
                    <p>æ”¯æŒæŒ‰å§“åã€é‚®ç®±æˆ–å¤‡æ³¨è¿›è¡Œå®æ—¶æœç´¢</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“¤ æ•°æ®å¯¼å‡º</h3>
                    <p>å¯ä»¥å°†æ‰€æœ‰æ•°æ®å¯¼å‡ºä¸ºJSONæ–‡ä»¶</p>
                </div>
                <div class="info-card">
                    <h3>ğŸ“¥ æ•°æ®å¯¼å…¥</h3>
                    <p>æ”¯æŒä»JSONæ–‡ä»¶å¯¼å…¥æ•°æ®</p>
                </div>
            </div>
        </div>

        <div class="log-section">
            <h2>ğŸ“‹ æ“ä½œæ—¥å¿—</h2>
            <div id="logContainer" class="log-container">
                <!-- æ“ä½œæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker æ³¨å†Œå’ŒçŠ¶æ€ç®¡ç† -->
    <script>
        // PWAçŠ¶æ€ç®¡ç†
        class PWAManager {
            constructor() {
                this.isOnline = navigator.onLine;
                this.isInstalled = window.matchMedia('(display-mode: standalone)').matches;
                this.init();
            }
            
            init() {
                this.registerServiceWorker();
                this.setupNetworkListeners();
                this.setupInstallPrompt();
                this.showStatusIndicator();
            }
            
            // æ³¨å†ŒService Worker
            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('/sw.js')
                            .then((registration) => {
                                console.log('Service Workeræ³¨å†ŒæˆåŠŸ:', registration.scope);
                                this.updateStatus('Service Workerå·²æ¿€æ´»');
                            })
                            .catch((error) => {
                                console.log('Service Workeræ³¨å†Œå¤±è´¥:', error);
                                this.updateStatus('Service Workeræ³¨å†Œå¤±è´¥');
                            });
                    });
                }
            }
            
            // è®¾ç½®ç½‘ç»œçŠ¶æ€ç›‘å¬
            setupNetworkListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateStatus('ç½‘ç»œå·²è¿æ¥');
                    this.hideOfflineIndicator();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateStatus('ç½‘ç»œå·²æ–­å¼€ï¼Œä½†åº”ç”¨ä»å¯ç¦»çº¿ä½¿ç”¨');
                    this.showOfflineIndicator();
                });
            }
            
            // è®¾ç½®å®‰è£…æç¤º
            setupInstallPrompt() {
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    this.showInstallButton(deferredPrompt);
                });
                
                // ç›‘å¬åº”ç”¨å®‰è£…å®Œæˆ
                window.addEventListener('appinstalled', () => {
                    this.isInstalled = true;
                    this.updateStatus('åº”ç”¨å·²å®‰è£…åˆ°æ¡Œé¢');
                    this.hideInstallButton();
                });
            }
            
            // æ˜¾ç¤ºå®‰è£…æŒ‰é’®
            showInstallButton(deferredPrompt) {
                if (document.getElementById('pwa-install-btn')) return;
                
                const installButton = document.createElement('button');
                installButton.id = 'pwa-install-btn';
                installButton.textContent = 'ğŸ“± å®‰è£…åº”ç”¨';
                installButton.className = 'btn btn-primary';
                installButton.style.position = 'fixed';
                installButton.style.top = '20px';
                installButton.style.right = '20px';
                installButton.style.zIndex = '1000';
                installButton.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                
                installButton.addEventListener('click', () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…æç¤º');
                                this.updateStatus('æ­£åœ¨å®‰è£…åº”ç”¨...');
                            }
                            deferredPrompt = null;
                            this.hideInstallButton();
                        });
                    }
                });
                
                document.body.appendChild(installButton);
            }
            
            // éšè—å®‰è£…æŒ‰é’®
            hideInstallButton() {
                const installButton = document.getElementById('pwa-install-btn');
                if (installButton) {
                    installButton.remove();
                }
            }
            
            // æ˜¾ç¤ºç¦»çº¿æŒ‡ç¤ºå™¨
            showOfflineIndicator() {
                if (document.getElementById('offline-indicator')) return;
                
                const indicator = document.createElement('div');
                indicator.id = 'offline-indicator';
                indicator.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: #ff6b6b;
                        color: white;
                        text-align: center;
                        padding: 8px;
                        font-size: 14px;
                        z-index: 9999;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    ">
                        ğŸ“± ç¦»çº¿æ¨¡å¼ - åº”ç”¨ä»å¯æ­£å¸¸ä½¿ç”¨
                    </div>
                `;
                document.body.appendChild(indicator);
            }
            
            // éšè—ç¦»çº¿æŒ‡ç¤ºå™¨
            hideOfflineIndicator() {
                const indicator = document.getElementById('offline-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
            
            // æ˜¾ç¤ºçŠ¶æ€æŒ‡ç¤ºå™¨
            showStatusIndicator() {
                const statusDiv = document.createElement('div');
                statusDiv.id = 'pwa-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    z-index: 1000;
                    opacity: 0.8;
                    transition: opacity 0.3s;
                `;
                statusDiv.textContent = this.isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿';
                document.body.appendChild(statusDiv);
                
                // 3ç§’åéšè—çŠ¶æ€æŒ‡ç¤ºå™¨
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    setTimeout(() => statusDiv.remove(), 300);
                }, 3000);
            }
            
            // æ›´æ–°çŠ¶æ€
            updateStatus(message) {
                const statusDiv = document.getElementById('pwa-status');
                if (statusDiv) {
                    statusDiv.textContent = message;
                    statusDiv.style.opacity = '1';
                    
                    setTimeout(() => {
                        statusDiv.style.opacity = '0';
                        setTimeout(() => statusDiv.remove(), 300);
                    }, 2000);
                }
            }
        }
        
        // åˆå§‹åŒ–PWAç®¡ç†å™¨
        const pwaManager = new PWAManager();
    </script>
</body>
</html>
